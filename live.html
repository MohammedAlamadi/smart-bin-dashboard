<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartWaste ‚Äì Live Smart Bin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050814;
      --bg-card: #0b1020;
      --bg-card-soft: #0f1526;
      --accent: #ffb347;
      --accent-soft: rgba(255, 179, 71, 0.18);
      --text: #f9fafb;
      --text-soft: #9ca3af;
      --border-soft: #1f2937;
      --good: #22c55e;
      --warn: #eab308;
      --bad: #ef4444;
      --pill-bg: #111827;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
    }

    /* NAVBAR */

    .nav {
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(20px);
      background: linear-gradient(to right, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.75));
      border-bottom: 1px solid rgba(31, 41, 55, 0.8);
    }

    .nav-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 20px;
    }

    .brand-dot {
      width: 22px;
      height: 22px;
      border-radius: 7px;
      background: radial-gradient(circle at 30% 0, #fff 0, #ffe6b7 25%, #f97316 55%, #db2777 100%);
      box-shadow: 0 0 20px rgba(248, 250, 252, 0.3);
    }

    .brand span {
      letter-spacing: 0.04em;
    }

    .nav-links {
      display: flex;
      gap: 18px;
      font-size: 14px;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--text-soft);
      padding: 6px 10px;
      border-radius: 999px;
      transition: 0.16s;
    }

    .nav-links a:hover {
      color: var(--text);
      background: rgba(31, 41, 55, 0.85);
    }

    .nav-links a.active {
      color: #fefce8;
      background: rgba(234, 179, 8, 0.18);
      border: 1px solid rgba(250, 204, 21, 0.5);
      box-shadow: 0 0 12px rgba(234, 179, 8, 0.3);
    }

    /* LAYOUT */

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 32px 20px 40px;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 24px;
      margin-bottom: 26px;
    }

    .page-title {
      font-size: 30px;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--text-soft);
      margin-top: 6px;
      max-width: 480px;
    }

    .last-update {
      font-size: 12px;
      color: var(--text-soft);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .last-update span {
      font-weight: 500;
      color: #e5e7eb;
    }

    /* GRID */

    .grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 18px;
    }

    @media (max-width: 800px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .page-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .last-update {
        align-items: flex-start;
      }
    }

    /* CARDS */

    .card {
      background: radial-gradient(circle at top left, #111827 0, #020617 50%);
      border-radius: 18px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 18px 18px 16px;
      box-shadow:
        0 18px 40px rgba(15, 23, 42, 0.85),
        0 0 0 1px rgba(15, 23, 42, 0.8);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      background: rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: 0 0 10px rgba(15, 23, 42, 0.9);
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: var(--pill-bg);
      color: #e5e7eb;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .pill-soft {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
      color: #e5e7eb;
    }

    .pill.good {
      border-color: rgba(34, 197, 94, 0.8);
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.15);
    }

    .pill.warn {
      border-color: rgba(234, 179, 8, 0.8);
      color: #fef9c3;
      background: rgba(202, 138, 4, 0.18);
    }

    .pill.bad {
      border-color: rgba(239, 68, 68, 0.8);
      color: #fecaca;
      background: rgba(185, 28, 28, 0.18);
    }

    .card-main {
      display: flex;
      align-items: baseline;
      gap: 6px;
      margin-bottom: 6px;
      margin-top: 2px;
    }

    .value-big {
      font-size: 30px;
      font-weight: 700;
    }

    .value-unit {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-soft);
    }

    .secondary {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .progress {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.9);
      margin-bottom: 8px;
    }

    .progress-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #a3e635);
      transition: width 0.3s ease;
    }

    .text-tag {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 2px;
    }

    /* ALERT CARD */

    .card-alert {
      margin-top: 20px;
      padding: 16px 18px;
      border-radius: 18px;
      border: 1px solid rgba(248, 250, 252, 0.08);
      background: radial-gradient(circle at left, rgba(251, 191, 36, 0.06), #020617 55%);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .alert-header {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .alert-dot {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(250, 204, 21, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      background: rgba(22, 163, 74, 0.07);
      color: #facc15;
    }

    .alert-text {
      font-size: 13px;
      color: var(--text-soft);
    }

    .alert-good {
      color: #bbf7d0;
    }

    .alert-bad {
      color: #fecaca;
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="nav-inner">
      <div class="brand">
        <div class="brand-dot"></div>
        <span>SmartWaste</span>
      </div>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="system.html">System Overview</a>
        <a href="live.html" class="active">Live Dashboard</a>
        <a href="routes.html">Smart Routes</a>
        <a href="food-energy.html">Food ‚Üí Energy</a>
        <a href="sustainability.html">Sustainability</a>
        <a href="ai-sorting.html">AI Sorting</a>
        <a href="team.html">Team</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <!-- HEADER -->
    <section class="page-header">
      <div>
        <h1 class="page-title">Live Smart Bin Dashboard</h1>
        <p class="page-subtitle">
          Real-time monitoring of bin fill levels, capacity left, and smell status from the physical prototype.
        </p>
      </div>
      <div class="last-update">
        <span>Live Firebase feed</span>
        <div id="last-update-text">Last update: --:--:--</div>
      </div>
    </section>

    <!-- GRID -->
    <section class="grid">
      <!-- FOOD BIN -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-icon">ü•ó</div>
              Food Waste Bin
            </div>
            <div class="card-subtitle">Organic food waste & smell detection</div>
          </div>
          <div class="pill-soft" id="food-badge">EMPTY</div>
        </div>

        <div class="card-main">
          <div class="value-big" id="food-fill">0%</div>
          <div class="value-unit">full</div>
        </div>

        <div class="secondary" id="food-capacity">Capacity left: --%</div>

        <div class="progress">
          <div class="progress-inner" id="food-bar"></div>
        </div>

        <div class="pill good" id="food-status-tag">Status: Empty / Low</div>
      </article>

      <!-- RECYCLE BIN -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-icon">‚ôªÔ∏è</div>
              Recycle Bin
            </div>
            <div class="card-subtitle">Plastics, paper & recyclables</div>
          </div>
          <div class="pill-soft" id="recycle-badge">EMPTY</div>
        </div>

        <div class="card-main">
          <div class="value-big" id="recycle-fill">0%</div>
          <div class="value-unit">full</div>
        </div>

        <div class="secondary" id="recycle-capacity">Capacity left: --%</div>

        <div class="progress">
          <div class="progress-inner" id="recycle-bar"></div>
        </div>

        <div class="pill good" id="recycle-status-tag">Status: Empty / Low</div>
      </article>

      <!-- GENERAL BIN -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-icon">üóëÔ∏è</div>
              General Waste Bin
            </div>
            <div class="card-subtitle">Mixed non-recyclable waste</div>
          </div>
          <div class="pill-soft" id="general-badge">EMPTY</div>
        </div>

        <div class="card-main">
          <div class="value-big" id="general-fill">0%</div>
          <div class="value-unit">full</div>
        </div>

        <div class="secondary" id="general-capacity">Capacity left: --%</div>

        <div class="progress">
          <div class="progress-inner" id="general-bar"></div>
        </div>

        <div class="pill good" id="general-status-tag">Status: Empty / Low</div>
      </article>

      <!-- SMELL / GAS -->
      <article class="card">
        <div class="card-header">
          <div>
            <div class="card-title">
              <div class="card-icon">„Ä∞Ô∏è</div>
              Smell / Gas Sensor
            </div>
            <div class="card-subtitle">Food decomposition & gas level (MQ sensor)</div>
          </div>
          <div class="pill-soft good" id="smell-badge">CLEAN</div>
        </div>

        <div class="card-main">
          <div class="value-big" id="smell-mq">MQ: --</div>
        </div>

        <div class="progress">
          <div class="progress-inner" id="smell-bar"></div>
        </div>

        <div class="pill good" id="smell-status-pill">Smell level normal.</div>
        <div class="text-tag" id="smell-tag">
          Sensor monitoring odour around the food waste bin. Higher values indicate stronger smell.
        </div>
      </article>
    </section>

    <!-- ALERT BAR -->
    <section class="card-alert">
      <div class="alert-header">
        <div class="alert-dot">‚óè</div>
        <div>Live Alerts</div>
      </div>
      <div class="alert-text" id="alert-text">
        No critical alerts. All bins are operating within safe limits.
      </div>
    </section>
  </main>

  <!-- FIREBASE SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // üî• Use YOUR existing config here
    const firebaseConfig = {
      databaseURL: "https://smartbin-52978-default-rtdb.firebaseio.com/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const statusRef = db.ref("bins/status");

    function setBadgeState(element, level) {
      const el = document.getElementById(element);
      if (!el) return;

      const lvl = (level || "EMPTY").toUpperCase();
      el.textContent = lvl;

      el.classList.remove("good", "warn", "bad");
      if (lvl === "FULL" || lvl === "HIGH") {
        el.classList.add("bad");
      } else if (lvl === "HALF" || lvl === "MEDIUM") {
        el.classList.add("warn");
      } else {
        el.classList.add("good");
      }
    }

    function updateBinCard(key, data) {
      if (!data) return;

      const fill = typeof data.fill_pct === "number" ? data.fill_pct : 0;
      const level = data.level || "EMPTY";

      const fillEl = document.getElementById(`${key}-fill`);
      const capEl = document.getElementById(`${key}-capacity`);
      const barEl = document.getElementById(`${key}-bar`);
      const tagEl = document.getElementById(`${key}-status-tag`);

      if (fillEl) fillEl.textContent = `${fill}%`;

      const capacityLeft = Math.max(0, Math.min(100, 100 - fill));
      if (capEl) capEl.textContent = `Capacity left: ${capacityLeft}%`;

      if (barEl) {
        barEl.style.width = `${fill}%`;
        if (fill >= 90) {
          barEl.style.background = "linear-gradient(90deg, #fb7185, #ef4444)";
        } else if (fill >= 60) {
          barEl.style.background = "linear-gradient(90deg, #fbbf24, #f97316)";
        } else {
          barEl.style.background = "linear-gradient(90deg, #22c55e, #a3e635)";
        }
      }

      let statusText = "";
      let extraClass = "good";

      if (fill >= 90) {
        statusText = "Status: Full / Critical";
        extraClass = "bad";
      } else if (fill >= 60) {
        statusText = "Status: High / Schedule soon";
        extraClass = "warn";
      } else {
        statusText = "Status: Empty / Low";
        extraClass = "good";
      }

      if (tagEl) {
        tagEl.textContent = statusText;
        tagEl.className = `pill ${extraClass}`;
      }

      setBadgeState(`${key}-badge`, level);
    }

    function updateSmellCard(smell) {
      const mqEl = document.getElementById("smell-mq");
      const barEl = document.getElementById("smell-bar");
      const pillEl = document.getElementById("smell-status-pill");
      const tagEl = document.getElementById("smell-tag");
      const badgeEl = document.getElementById("smell-badge");

      if (!smell) {
        mqEl.textContent = "MQ: --";
        barEl.style.width = "0%";
        pillEl.textContent = "Waiting for sensor data‚Ä¶";
        pillEl.className = "pill warn";
        badgeEl.textContent = "--";
        return;
      }

      const mq = smell.mq_value ?? 0;
      const status = (smell.status || smell.level || "CLEAN").toUpperCase();

      mqEl.textContent = `MQ: ${mq}`;

      // Normalize MQ to bar 0‚Äì100% (adjust if your sensor values change)
      let pct = Math.max(0, Math.min(100, (mq / 3000) * 100));
      barEl.style.width = pct + "%";

      let pillClass = "good";
      let text = "";

      if (status === "BAD") {
        pillClass = "bad";
        barEl.style.background =
          "linear-gradient(90deg, #fb7185, #ef4444)";
        text = "High smell level ‚Äì check food waste bin.";
      } else if (status === "MEDIUM") {
        pillClass = "warn";
        barEl.style.background =
          "linear-gradient(90deg, #fbbf24, #f97316)";
        text = "Medium smell level ‚Äì monitoring.";
      } else {
        pillClass = "good";
        barEl.style.background =
          "linear-gradient(90deg, #22c55e, #a3e635)";
        text = "Smell level normal.";
      }

      pillEl.textContent = text;
      pillEl.className = `pill ${pillClass}`;
      badgeEl.textContent = status;
      badgeEl.className = `pill-soft ${pillClass}`;
      tagEl.textContent =
        "Smell sensor helps detect early food decomposition and potential hygiene issues.";
    }

    function updateAlertBanner(status) {
      const alertTextEl = document.getElementById("alert-text");
      const alertDot = document.querySelector(".alert-dot");

      if (!alertTextEl || !status) return;

      const bins = ["food", "recycle", "general"];
      let criticalMessages = [];

      bins.forEach((b) => {
        const d = status[b];
        if (!d) return;
        const fill = d.fill_pct ?? 0;
        const label = b === "food" ? "Food bin" : b === "recycle" ? "Recycle bin" : "General bin";

        if (fill >= 90) {
          criticalMessages.push(`${label} is FULL ‚Äì immediate collection required.`);
        } else if (fill >= 70) {
          criticalMessages.push(`${label} is getting high ‚Äì schedule collection soon.`);
        }
      });

      const smell = status.smell;
      if (smell && (smell.status || "").toUpperCase() === "BAD") {
        criticalMessages.push("High odour detected near food waste ‚Äì check hygiene & collection.");
      }

      if (criticalMessages.length === 0) {
        alertTextEl.textContent =
          "No critical alerts. All bins are within safe capacity and smell levels.";
        alertTextEl.classList.remove("alert-bad");
        alertTextEl.classList.add("alert-good");
        alertDot.style.borderColor = "rgba(34,197,94,0.8)";
        alertDot.style.color = "#bbf7d0";
      } else {
        alertTextEl.textContent = criticalMessages.join(" ");
        alertTextEl.classList.remove("alert-good");
        alertTextEl.classList.add("alert-bad");
        alertDot.style.borderColor = "rgba(248,113,113,0.9)";
        alertDot.style.color = "#fecaca";
      }
    }

    function updateLastUpdated() {
      const el = document.getElementById("last-update-text");
      if (!el) return;
      const now = new Date();
      const timeStr = now.toLocaleTimeString("en-GB", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });
      el.textContent = `Last update: ${timeStr}`;
    }

    statusRef.on("value", (snapshot) => {
      const data = snapshot.val() || {};

      updateBinCard("food", data.food);
      updateBinCard("recycle", data.recycle);
      updateBinCard("general", data.general);
      updateSmellCard(data.smell);
      updateAlertBanner(data);
      updateLastUpdated();
    });
  </script>
</body>
</html>
