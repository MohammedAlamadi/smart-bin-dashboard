<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Dashboard - Smart Waste</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/phosphor-icons"></script>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }
    body {
      background: #050815;
      color: #f9fafb;
      min-height: 100vh;
    }

    /* Navbar */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 18px 40px;
      background: rgba(5, 8, 21, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 999;
      transition: 0.3s;
    }
    nav.scrolled {
      background: rgba(5, 8, 21, 1);
    }
    nav .logo {
      font-size: 1.5rem;
      font-weight: 700;
    }
    nav ul {
      display: flex;
      gap: 30px;
      list-style: none;
    }
    nav ul li a {
      text-decoration: none;
      color: #e5e7eb;
      font-weight: 400;
      font-size: 0.95rem;
      transition: 0.2s;
    }
    nav ul li a:hover {
      color: #4ae3ff;
    }

    /* Layout */
    .page {
      padding: 110px 8% 40px;
    }
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 25px;
    }
    .page-header h1 {
      font-size: 2.4rem;
    }
    .page-header p {
      opacity: 0.8;
    }
    .timestamp {
      font-size: 0.9rem;
      opacity: 0.7;
      text-align: right;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .card {
      background: radial-gradient(circle at top left, #1f2937, #030712);
      border-radius: 16px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 12px 30px rgba(0,0,0,0.45);
      border: 1px solid rgba(148, 163, 184, 0.25);
      animation: floatIn 0.6s ease-out;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .card-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .card-title i {
      font-size: 26px;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .main-value {
      font-size: 2.4rem;
      font-weight: 700;
      margin: 5px 0;
    }
    .secondary {
      font-size: 0.95rem;
      opacity: 0.8;
    }

    /* Progress bar */
    .progress-shell {
      margin-top: 14px;
      width: 100%;
      height: 9px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      position: relative;
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      transition: width 0.4s ease-out, background 0.3s;
    }

    .tag {
      display: inline-block;
      margin-top: 8px;
      font-size: 0.8rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.25);
      color: #a5f3fc;
    }

    /* Fill status colors */
    .status-empty   { background: linear-gradient(90deg, #0f766e, #22c55e); }
    .status-medium  { background: linear-gradient(90deg, #eab308, #f97316); }
    .status-high    { background: linear-gradient(90deg, #f97316, #ef4444); }
    .status-full    { background: linear-gradient(90deg, #b91c1c, #dc2626); }

    /* Smell bar */
    .smell-shell {
      margin-top: 14px;
      width: 100%;
      height: 9px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
    }
    .smell-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      transition: width 0.4s ease-out, background 0.3s;
      background: linear-gradient(90deg, #22c55e, #84cc16);
    }

    /* Alerts */
    .alerts-card {
      border-left: 3px solid #f97316;
    }
    .alerts-title {
      font-size: 1.1rem;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .alert-item {
      background: rgba(248, 250, 252, 0.03);
      border-radius: 10px;
      padding: 10px 12px;
      margin-top: 6px;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .alert-badge {
      font-size: 0.75rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(248, 113, 113, 0.2);
      color: #fecaca;
    }
    .alert-ok {
      opacity: 0.7;
      font-size: 0.9rem;
    }

    @keyframes floatIn {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 800px) {
      nav {
        padding: 14px 18px;
      }
      nav ul {
        gap: 14px;
        font-size: 0.85rem;
      }
      .page {
        padding: 90px 16px 30px;
      }
      .page-header h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>

<body>

  <!-- Navbar -->
  <nav id="navbar">
    <div class="logo">SmartWaste</div>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="overview.html">System Overview</a></li>
      <li><a href="live.html">Live Dashboard</a></li>
      <li><a href="routes.html">Smart Routes</a></li>
      <li><a href="food.html">Food → Energy</a></li>
      <li><a href="sustainability.html">Sustainability</a></li>
      <li><a href="sorting.html">AI Sorting</a></li>
      <li><a href="contact.html">Team</a></li>
    </ul>
  </nav>

  <main class="page">
    <div class="page-header">
      <div>
        <h1>Live Smart Bin Dashboard</h1>
        <p>Real-time monitoring of bin fill levels and smell status from the prototype.</p>
      </div>
      <div class="timestamp" id="last-updated">Last update: --</div>
    </div>

    <section class="grid">
      <!-- Food Waste -->
      <div class="card" id="card-food">
        <div class="card-header">
          <div class="card-title">
            <i class="ph-fill ph-bowl-food"></i>
            <div>
              <div>Food Waste Bin</div>
              <small class="secondary">Organic waste & smell detection</small>
            </div>
          </div>
          <span class="badge" id="food-level-badge">--</span>
        </div>
        <div class="main-value" id="food-fill">--%</div>
        <div class="secondary" id="food-distance">Distance: -- cm</div>

        <div class="progress-shell">
          <div class="progress-fill" id="food-bar"></div>
        </div>
        <span class="tag" id="food-tag">Waiting for data…</span>
      </div>

      <!-- Recycle Bin -->
      <div class="card" id="card-recycle">
        <div class="card-header">
          <div class="card-title">
            <i class="ph-fill ph-recycle"></i>
            <div>
              <div>Recycle Bin</div>
              <small class="secondary">Plastics, paper & recyclables</small>
            </div>
          </div>
          <span class="badge" id="rec-level-badge">--</span>
        </div>
        <div class="main-value" id="rec-fill">--%</div>
        <div class="secondary" id="rec-distance">Distance: -- cm</div>

        <div class="progress-shell">
          <div class="progress-fill" id="rec-bar"></div>
        </div>
        <span class="tag" id="rec-tag">Waiting for data…</span>
      </div>

      <!-- General Bin -->
      <div class="card" id="card-general">
        <div class="card-header">
          <div class="card-title">
            <i class="ph-fill ph-trash"></i>
            <div>
              <div>General Waste Bin</div>
              <small class="secondary">Mixed non-recyclable waste</small>
            </div>
          </div>
          <span class="badge" id="gen-level-badge">--</span>
        </div>
        <div class="main-value" id="gen-fill">--%</div>
        <div class="secondary" id="gen-distance">Distance: -- cm</div>

        <div class="progress-shell">
          <div class="progress-fill" id="gen-bar"></div>
        </div>
        <span class="tag" id="gen-tag">Waiting for data…</span>
      </div>

      <!-- Smell / Gas -->
      <div class="card" id="card-smell">
        <div class="card-header">
          <div class="card-title">
            <i class="ph-fill ph-waves"></i>
            <div>
              <div>Smell / Gas Sensor</div>
              <small class="secondary">Food decomposition & gas level</small>
            </div>
          </div>
          <span class="badge" id="smell-status-badge">--</span>
        </div>
        <div class="main-value" id="smell-raw">MQ: --</div>


        <div class="smell-shell">
          <div class="smell-fill" id="smell-bar"></div>
        </div>
        <span class="tag" id="smell-tag">Waiting for data…</span>
      </div>
    </section>

    <!-- Alerts Section -->
    <section class="card alerts-card">
      <div class="alerts-title">
        <i class="ph-fill ph-warning-octagon"></i>
        <span>Live Alerts</span>
      </div>
      <div id="alerts-container">
        <div class="alert-ok">No critical alerts. All bins are operating within safe limits.</div>
      </div>
    </section>
  </main>

  <script>
    // Navbar scroll effect
    window.addEventListener("scroll", () => {
      const nav = document.getElementById("navbar");
      nav.classList.toggle("scrolled", window.scrollY > 10);
    });

    // ---- Firebase config (use your own DB URL if different) ----
    const firebaseConfig = {
      databaseURL: "https://smartbin-52978-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const lastUpdatedEl = document.getElementById("last-updated");

    function setBinCard(prefix, binData) {
      const fillEl = document.getElementById(prefix + "-fill");
      const distEl = document.getElementById(prefix + "-distance");
      const barEl  = document.getElementById(prefix + "-bar");
      const tagEl  = document.getElementById(prefix + "-tag");
      const badgeEl = document.getElementById(prefix + "-level-badge");
      const cardEl = document.getElementById("card-" + prefix);

      if (!binData) {
        fillEl.textContent = "--%";
        distEl.textContent = "Distance: -- cm";
        tagEl.textContent = "No data";
        badgeEl.textContent = "--";
        barEl.style.width = "0%";
        barEl.className = "progress-fill";
        return;
      }

      const fill = binData.fill_pct ?? -1;
      const dist = binData.distance_cm ?? -1;
      const levelStr = binData.level ?? "--";

      if (fill < 0) {
        fillEl.textContent = "--%";
        distEl.textContent = "Sensor error / no echo";
        tagEl.textContent = "Check sensor alignment";
        badgeEl.textContent = "ERROR";
        barEl.style.width = "0%";
        barEl.className = "progress-fill status-empty";
        return;
      }

      fillEl.textContent = fill + "%";
      if (dist >= 0) {
        distEl.textContent = "Distance: " + dist.toFixed(1) + " cm";
      } else {
        distEl.textContent = "Distance: -- cm";
      }

      let statusClass = "status-empty";
      let statusLabel = "Empty / Low";
      if (fill >= 90) {
        statusClass = "status-full";
        statusLabel = "FULL";
      } else if (fill >= 70) {
        statusClass = "status-high";
        statusLabel = "High";
      } else if (fill >= 40) {
        statusClass = "status-medium";
        statusLabel = "Medium";
      }

      barEl.style.width = fill + "%";
      barEl.className = "progress-fill " + statusClass;

      badgeEl.textContent = levelStr;
      tagEl.textContent = "Status: " + statusLabel;
    }

    function setSmellCard(smell) {
  const barEl = document.getElementById("smell-bar");
  const rawEl = document.getElementById("smell-raw");
  const tagEl = document.getElementById("smell-tag");
  const badgeEl = document.getElementById("smell-status-badge");

  if (!smell) {
    rawEl.textContent = "MQ: --";
    badgeEl.textContent = "--";
    barEl.style.width = "0%";
    tagEl.textContent = "Waiting for sensor data…";
    return;
  }

  const mq = smell.mq_value ?? 0;
  const status = smell.status ?? smell.level ?? "CLEAN";

  rawEl.textContent = "MQ: " + mq;
  badgeEl.textContent = status.toUpperCase();

  // Normalize MQ to 0–100% for bar
  // adjust based on real sensor range
  let pct = Math.min(100, Math.max(0, (mq / 3000) * 100));
  barEl.style.width = pct + "%";

  if (status.toUpperCase() === "BAD") {
    barEl.style.background = "linear-gradient(90deg, #ea580c, #ef4444)";
    tagEl.textContent = "Strong smell detected – food waste decomposing.";
  } else if (status.toUpperCase() === "MEDIUM") {
    barEl.style.background = "linear-gradient(90deg, #eab308, #f97316)";
    tagEl.textContent = "Medium smell detected – keep monitoring.";
  } else {
    barEl.style.background = "linear-gradient(90deg, #22c55e, #84cc16)";
    tagEl.textContent = "Smell level normal.";
  }
}


    function updateAlerts(data) {
      const alertsEl = document.getElementById("alerts-container");
      alertsEl.innerHTML = "";

      const alerts = [];

      function pushBinAlert(name, bin) {
        if (!bin || bin.fill_pct == null || bin.fill_pct < 0) return;
        if (bin.fill_pct >= 90) {
          alerts.push({
            text: name + " is FULL (" + bin.fill_pct + "%).",
            type: "FULL"
          });
        } else if (bin.fill_pct >= 70) {
          alerts.push({
            text: name + " is above 70% (" + bin.fill_pct + "%).",
            type: "HIGH"
          });
        }
      }

      if (data.food)    pushBinAlert("Food Waste Bin", data.food);
      if (data.recycle) pushBinAlert("Recycle Bin", data.recycle);
      if (data.general) pushBinAlert("General Waste Bin", data.general);

      if (data.smell && (data.smell.status || data.smell.level)) {
        const s = (data.smell.status || data.smell.level).toUpperCase();
        if (s === "BAD") {
          alerts.push({
            text: "Smell level is BAD – possible strong food decomposition.",
            type: "SMELL"
          });
        }
      }

      if (alerts.length === 0) {
        const okDiv = document.createElement("div");
        okDiv.className = "alert-ok";
        okDiv.textContent = "No critical alerts. All bins are operating within safe limits.";
        alertsEl.appendChild(okDiv);
        return;
      }

      alerts.forEach(a => {
        const row = document.createElement("div");
        row.className = "alert-item";
        const spanText = document.createElement("span");
        spanText.textContent = a.text;
        const badge = document.createElement("span");
        badge.className = "alert-badge";
        badge.textContent = a.type;
        row.appendChild(spanText);
        row.appendChild(badge);
        alertsEl.appendChild(row);
      });
    }

    // Realtime listener
    db.ref("bins/status").on("value", snap => {
      const data = snap.val();
      if (!data) return;

      setBinCard("food",    data.food);
      setBinCard("rec",     data.recycle);
      setBinCard("gen",     data.general);
      setSmellCard(data.smell);

      updateAlerts(data);

      const now = new Date();
      lastUpdatedEl.textContent = "Last update: " + now.toLocaleTimeString();
    }, err => {
      console.error("Firebase error:", err);
    });
  </script>
</body>
</html>
